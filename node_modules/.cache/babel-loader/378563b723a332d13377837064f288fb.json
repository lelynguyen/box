{"ast":null,"code":"var __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar _SnowfallCanvas_ctx, _SnowfallCanvas_canvas;\nimport Snowflake, { defaultConfig } from './Snowflake.js';\nimport { targetFrameTime } from './config.js';\nexport class SnowfallCanvas {\n  get ctx() {\n    return __classPrivateFieldGet(this, _SnowfallCanvas_ctx, \"f\");\n  }\n  get canvas() {\n    return __classPrivateFieldGet(this, _SnowfallCanvas_canvas, \"f\");\n  }\n  set canvas(canvas) {\n    __classPrivateFieldSet(this, _SnowfallCanvas_canvas, canvas, \"f\");\n    __classPrivateFieldSet(this, _SnowfallCanvas_ctx, canvas.getContext('2d'), \"f\");\n  }\n  constructor(canvas, config) {\n    this.lastUpdate = Date.now();\n    this.snowflakes = [];\n    _SnowfallCanvas_ctx.set(this, void 0);\n    _SnowfallCanvas_canvas.set(this, void 0);\n    __classPrivateFieldSet(this, _SnowfallCanvas_canvas, canvas, \"f\");\n    __classPrivateFieldSet(this, _SnowfallCanvas_ctx, canvas.getContext('2d'), \"f\");\n    this.config = {\n      snowflakeCount: 150,\n      ...defaultConfig,\n      ...config\n    };\n    this.snowflakes = [];\n    this.snowflakes = Snowflake.createSnowflakes(canvas, config.snowflakeCount || 150, config);\n    this.play();\n  }\n  /**\n   * Updates the config used for the snowfall animation, if the number of snowflakes\n   * has changed then this will create new or remove existing snowflakes gracefully\n   * to retain the position of as many existing snowflakes as possible.\n   */\n  updateConfig(config) {\n    this.config = {\n      ...this.config,\n      ...config\n    };\n    const sizeDifference = this.config.snowflakeCount - this.snowflakes.length;\n    if (sizeDifference > 0) {\n      this.snowflakes = [...this.snowflakes, ...Snowflake.createSnowflakes(this.canvas, sizeDifference, config)];\n    }\n    if (sizeDifference < 0) {\n      this.snowflakes = this.snowflakes.slice(0, this.config.snowflakeCount);\n    }\n    for (const snowflake of this.snowflakes) {\n      snowflake.updateConfig(this.config);\n    }\n  }\n  /**\n   * Updates the location of each snowflake based on the number of frames passed then\n   * clears the canvas and draws each snowflake.\n   */\n  render(framesPassed = 1) {\n    const {\n      ctx,\n      canvas,\n      snowflakes\n    } = this;\n    if (!ctx || !canvas) return;\n    const {\n      offsetWidth,\n      offsetHeight\n    } = canvas;\n    // Update the position of each snowflake\n    for (const snowflake of snowflakes) {\n      snowflake.update(offsetWidth, offsetHeight, framesPassed);\n    }\n    // Render the snowflakes\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    ctx.clearRect(0, 0, offsetWidth, offsetHeight);\n    // If using images, draw each image individually\n    if (this.config.images && this.config.images.length > 0) {\n      for (const snowflake of snowflakes) {\n        snowflake.drawImage(ctx);\n      }\n      return;\n    }\n    // Not using images, draw circles in a single path\n    ctx.beginPath();\n    for (const snowflake of snowflakes) {\n      snowflake.drawCircle(ctx);\n    }\n    ctx.fillStyle = this.config.color;\n    ctx.fill();\n  }\n  /**\n   * The animation loop, will calculate the time since the last render and update\n   * the position of the snowflakes appropriately before queueing another frame.\n   */\n  loop() {\n    // Update based on time passed so that a slow frame rate won't slow down the snowflake\n    const now = Date.now();\n    const msPassed = Date.now() - this.lastUpdate;\n    this.lastUpdate = now;\n    // Frames that would have passed if running at 60 fps\n    const framesPassed = msPassed / targetFrameTime;\n    this.render(framesPassed);\n    this.animationFrame = requestAnimationFrame(() => this.loop());\n  }\n  /** Start the animation playing. */\n  play() {\n    this.loop();\n  }\n  /** Pause the animation. */\n  pause() {\n    if (this.animationFrame) {\n      cancelAnimationFrame(this.animationFrame);\n      this.animationFrame = undefined;\n    }\n  }\n}\n_SnowfallCanvas_ctx = new WeakMap(), _SnowfallCanvas_canvas = new WeakMap();\nexport default SnowfallCanvas;","map":{"version":3,"names":["Snowflake","defaultConfig","targetFrameTime","SnowfallCanvas","ctx","__classPrivateFieldGet","_SnowfallCanvas_ctx","canvas","_SnowfallCanvas_canvas","__classPrivateFieldSet","getContext","constructor","config","lastUpdate","Date","now","snowflakes","set","snowflakeCount","createSnowflakes","play","updateConfig","sizeDifference","length","slice","snowflake","render","framesPassed","offsetWidth","offsetHeight","update","setTransform","clearRect","images","drawImage","beginPath","drawCircle","fillStyle","color","fill","loop","msPassed","animationFrame","requestAnimationFrame","pause","cancelAnimationFrame","undefined"],"sources":["../src/SnowfallCanvas.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}